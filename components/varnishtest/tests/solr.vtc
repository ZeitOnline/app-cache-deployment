varnishtest "Content from solr is delivered and cached"


server s1 {
    rxreq
    expect req.url == "/solr/website/select/fuselfoo"
    expect req.http.Cookie == <undef>
    txresp -hdr "X-Backend: solr"
} -start

@ call varnish(['solr'])
    include "/etc/varnish/vcl_includes/main.vcl";
@ endcall

client c1 {
    txreq -url "/website-solr/select/fuselfoo" \
        -hdr "Host: app-cache.zeit.de" -hdr "Cookie: foo"
    rxresp
    expect resp.http.X-Backend == "solr"
} -run
